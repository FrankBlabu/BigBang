# Step 03 — Project Initialization (Seeding)

> Build a CLI tool and agent prompt that can bootstrap a new project with all appropriate artifacts from BigBang's canonical templates.

<!-- Model: Sonnet | Extended Thinking: No -->

## Objective

Create the seeding workflow — the core value proposition of BigBang. A single command (or agent prompt) should initialize a target project with the correct copilot-instructions, prompt files, learnings, and manifest, tailored to the project's technology stack.

## Implementation Details

### 3.1 `scripts/seed.py` CLI

A click-based CLI tool for bootstrapping new projects:

```
Usage: bigbang-seed [OPTIONS] TARGET_PATH

  Bootstrap a new project with BigBang artifacts.

Options:
  --name TEXT          Project name for prompt prefixes (required)
  --stack TEXT          Comma-separated stacks: python,typescript,cpp,devops (required)
  --description TEXT    One-line project description (default: "")
  --dry-run            Preview what would be created without writing files
  --help               Show this message and exit
```

**Core workflow**:

```python
def seed(target_path: Path, name: str, stack: list[str], description: str, dry_run: bool) -> None:
    # 1. Validate target path exists and is a git repo (or offer to git init)
    # 2. Check for existing .bigbang.json (warn if re-seeding)
    # 3. Load and render templates
    #    a. Compose copilot-instructions from base + selected overlays
    #    b. Render prompt templates with project_name substitution
    #    c. Compose LEARNINGS.md from relevant domain files
    # 4. Write files to target
    #    a. .github/copilot-instructions.md
    #    b. .github/prompts/{name}_*.prompt.md
    #    c. LEARNINGS.md
    #    d. .bigbang.json manifest
    # 5. Compute SHA-256 hashes of all written files
    # 6. Write .bigbang.json with hashes
    # 7. Print summary
```

**File operations detail**:

| Source (BigBang) | Target (Seeded Project) | Operation |
|------------------|------------------------|-----------|
| `templates/copilot-instructions/base.md` | `.github/copilot-instructions.md` | Compose with overlays |
| `templates/copilot-instructions/{stack}.md` | *(merged into above)* | Concatenated per stack |
| `templates/prompts/_implement.prompt.md` | `.github/prompts/{name}_implement.prompt.md` | Render + rename |
| `templates/prompts/_commit.prompt.md` | `.github/prompts/{name}_commit.prompt.md` | Render + rename |
| `templates/prompts/_system.prompt.md` | `.github/prompts/{name}_system.prompt.md` | Render + rename |
| `templates/prompts/_maintenance.prompt.md` | `.github/prompts/{name}_maintenance.prompt.md` | Render + rename |
| `templates/prompts/_update.prompt.md` | `.github/prompts/{name}_update.prompt.md` | Render + rename |
| `templates/prompts/_coverage.prompt.md` | `.github/prompts/{name}_coverage.prompt.md` | Render + rename |
| `learnings/LEARNINGS.md` | `LEARNINGS.md` | Compose with domain learnings |
| `learnings/LEARNINGS.{stack}.md` | *(merged into above)* | Concatenated per stack |
| *(generated)* | `.bigbang.json` | Created with metadata + hashes |

### 3.2 Template Rendering

The rendering is intentionally simple — `str.replace()` for two placeholders:

```python
def render_template(content: str, project_name: str, project_description: str) -> str:
    """Replace template placeholders with actual values."""
    result = content.replace("{{project_name}}", project_name)
    result = result.replace("{{project_description}}", project_description)
    return result
```

**Prompt file renaming**:

```python
def rename_prompt_file(template_name: str, project_name: str) -> str:
    """Convert template name to project-specific name.

    Example: _implement.prompt.md -> pulsar_implement.prompt.md
    """
    if template_name.startswith("_"):
        return f"{project_name}{template_name}"  # _implement -> pulsar_implement
    return template_name
```

### 3.3 Copilot Instructions Composition

```python
def compose_copilot_instructions(
    base_path: Path,
    overlay_paths: list[Path],
    stack: list[str],
    bigbang_version: str,
) -> str:
    """Compose copilot-instructions from base + selected overlays."""
    header = (
        f"<!-- Generated by BigBang v{bigbang_version} -->\n"
        f"<!-- Stack: {','.join(stack)} -->\n\n"
    )

    base_content = base_path.read_text()
    sections = [header, base_content]

    for overlay_path in overlay_paths:
        if overlay_path.exists():
            sections.append(f"\n\n{overlay_path.read_text()}")

    return "\n".join(sections)
```

### 3.4 Manifest Generation

```python
def create_manifest(
    project_name: str,
    project_description: str,
    stack: list[str],
    bigbang_version: str,
    artifact_hashes: dict[str, str],
) -> dict:
    """Create a .bigbang.json manifest."""
    return {
        "project_name": project_name,
        "project_description": project_description,
        "stack": stack,
        "bigbang_version": bigbang_version,
        "seeded_at": datetime.now(UTC).isoformat(),
        "last_harvest": None,
        "last_push": None,
        "artifact_hashes": artifact_hashes,
    }
```

### 3.5 Re-seeding Protection

When `.bigbang.json` already exists in the target:

1. Read the existing manifest.
2. Compute current hashes of managed files.
3. Compare against stored `artifact_hashes`.
4. Report which files have been locally modified.
5. Ask for confirmation before overwriting modified files.
6. With `--dry-run`, show the report without writing.

### 3.6 `bigbang_seed.prompt.md` Agent Prompt

An agent prompt that wraps the CLI for interactive use:

```markdown
---
name: bigbang_seed
description: Bootstrap a new project from BigBang templates
agent: agent
---

# Objective

> Your goal is to seed a new project with BigBang's canonical agent artifacts.

# Workflow

## Gather project information

- Ask the user for the target project path.
- Ask the user for the project name (lowercase, used for prompt prefixes).
- Ask the user for the technology stack (python, typescript, cpp, devops).
- Ask the user for a one-line project description.

## Execute seeding

- Run the seed script: `bigbang-seed --name <name> --stack <stack> --description "<desc>" <target_path>`
- Review the output for any warnings or errors.

## Verify

- Check that all expected files were created in the target project.
- Verify that `.bigbang.json` was created with correct metadata.
- Verify that prompt files use the correct project name prefix.

## Optional: Initial commit

- Ask the user if they want to commit the seeded files.
- If yes, create an initial commit with message: "Initialize project with BigBang v<version>"
```

### 3.7 Stack Presets (Future Enhancement)

For convenience, consider predefined stack combinations:

| Preset | Stacks | Use Case |
|--------|--------|----------|
| `python` | `python` | Pure Python project |
| `typescript` | `typescript` | Pure TypeScript/Electron project |
| `cpp` | `cpp` | Pure C++/Qt project |
| `fullstack` | `python,typescript` | Full-stack web application |
| `all` | `python,typescript,cpp,devops` | Projects using all stacks |

This is a future enhancement — for now, explicit `--stack` flags are sufficient.

## Tests Required

| Test | Description | Expected Result |
|------|-------------|-----------------|
| Basic seed | Seed into temp directory with `--stack python` | All expected files created |
| Placeholder substitution | Check seeded files for `{{` | No remaining `{{project_name}}` or `{{project_description}}` |
| Manifest validity | Validate `.bigbang.json` against schema | Valid according to `manifest.schema.json` |
| Prompt naming | Check prompt file names | Files named `{name}_*.prompt.md` |
| Copilot composition | Read seeded `copilot-instructions.md` | Contains base rules + Python rules |
| Dry-run safety | Run with `--dry-run` | No files created in target |
| Re-seed detection | Seed twice into same directory | Warning about existing `.bigbang.json` |
| Multi-stack | Seed with `--stack python,typescript` | Both overlays present in copilot-instructions |
| Invalid stack | Seed with `--stack invalid` | Error with clear message |
| Missing target | Seed to non-existent directory | Error with clear message |

## Acceptance Criteria

- [ ] `bigbang-seed --name myproject --stack python /tmp/myproject` creates a fully bootstrapped project
- [ ] All prompt files use the target project name prefix (no `_` prefix, no `bigbang_` prefix)
- [ ] `copilot-instructions.md` contains base rules + selected domain rules
- [ ] `.bigbang.json` manifest is present and valid against schema
- [ ] `LEARNINGS.md` contains relevant domain learnings
- [ ] `--dry-run` mode produces output but no files
- [ ] Re-seeding detects existing manifest and warns
- [ ] All tests pass

## Dependencies

- [Phase 02](02-repository-structure.md) — Templates, schemas, and project structure must exist.

## Hints

- Use `pathlib` throughout for cross-platform path handling.
- The `hashlib.sha256()` function computes file hashes for the manifest.
- Target directory should already be a git repo. If not, warn but don't block — the user might initialize git later.
- Keep the CLI output clean and informative. Use click's `echo()` and `style()` for colored output.

## Risk & Complexity Assessment

**Overall: Low-Medium**

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
| Path handling edge cases | Medium | Low | Use `pathlib`, test on actual environment |
| Template contains literal `{{` | Low | Low | Use `str.replace()` (not Jinja2) to avoid conflict |
| Target directory not a git repo | Medium | Low | Warn but proceed; git init is the user's decision |
| Missing overlay files | Low | Low | Skip gracefully with a warning if a stack overlay doesn't exist yet |
